# =============================================================================
# 10-website.conf - Personal Website (christianblevens.me)
# =============================================================================
# Serves at: /
# Backend: Static files only
#
# BACKWARDS COMPATIBILITY:
# Requests to /?pageId=... are redirected to /mycomments/?pageId=...
# This ensures existing embedded comments continue to work until updated.
# =============================================================================

# Backwards compatibility: redirect root with pageId to /mycomments
# This catches requests from old embed codes that use data-instance pointing to root
location = / {
    # Check if pageId query parameter exists
    if ($arg_pageId) {
        return 301 /mycomments/$is_args$args;
    }

    # Normal website serving
    root /usr/share/nginx/html/website;
    index index.html;
    try_files $uri /index.html;

    # Allow embedding (for resume/project modals)
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header Cache-Control "no-cache, no-store, must-revalidate";
}

# Root path - Personal Website (all other paths)
# Note: This is a catch-all that will be overridden by more specific locations
# in other config files (20-mycomments.conf, 30-room.conf, etc.)
location / {
    root /usr/share/nginx/html/website;
    index index.html;
    try_files $uri $uri/ /index.html;

    # Allow embedding (for resume/project modals)
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header Cache-Control "no-cache, no-store, must-revalidate";
}

# Website static assets with long cache
location ~* ^/(?!mycomments|room|bpd).*\.(jpg|jpeg|png|gif|ico|css|js|woff|woff2|ttf|svg|eot|otf|map)$ {
    root /usr/share/nginx/html/website;
    expires 1y;
    add_header Cache-Control "public, immutable";
    add_header X-Frame-Options "SAMEORIGIN" always;
    access_log off;
}
